{% extends 'shop/base.html' %}

{% block content %}
<!-- AOS CSS -->
<link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">

<style>
  body {
    background: #17191d;
  }
  .product-title {
    color: #4fc3f7;
    font-weight: 700;
    letter-spacing: .04em;
    margin-bottom: 32px;
    margin-top: 14px;
    font-size: 2rem;
    text-shadow: 0 2px 14px #093b5021;
  }
  .card-custom {
    background: linear-gradient(112deg, #20252c 90%, #191c1f 100%);
    color: #fffce0;
    border-radius: 22px;
    padding: 22px 20px 18px 20px;
    text-align: center;
    box-shadow: 0 6px 28px 0 rgba(51,188,255,0.12), 0 2px 8px 0 rgba(255,255,255,0.05);
    transition: transform .23s cubic-bezier(.39,.575,.56,1.000), box-shadow .27s;
    position: relative;
    overflow: hidden;
  }
  .card-custom:hover {
    transform: translateY(-8px) scale(1.01);
    box-shadow: 0 14px 36px 0 rgba(61,181,255,0.19), 0 5px 18px 0 rgba(255,255,255,0.11);
  }
  .card-custom img {
    max-height: 200px;
    object-fit: contain;
    margin-bottom: 16px;
    filter: drop-shadow(0 2px 9px #00204426);
    background: #23282c;
    border-radius: 16px;
    padding: 8px;
    width: 100%;
    transition: box-shadow .2s;
  }
  .card-custom h5 {
    margin-top: 9px;
    margin-bottom: 6px;
    font-weight: 900;
    color: #ffd900;
    font-size: 1.6rem;
    letter-spacing: .01em;
    text-shadow: 0 1px 6px #282c2d18;
    line-height: 1.23;
  }
  .card-custom .price {
    font-weight: 700;
    font-size: 1.15rem;
    margin: 10px 0 13px 0;
    color: #fff;
    background: none !important;
    text-shadow: 0 2px 12px #ffd70028, 0 1px 0 #1b1b1b;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: filter .2s, font-size .22s;
  }
  .card-custom .text-muted {
    color: #bfc7ce !important;
    font-size: 1.02rem;
    margin-bottom: 11px;
  }
  .btn-outline-light {
    border: 1.5px solid #ffe15d;
    color: #ffe15d;
    background-color: transparent;
    font-weight: 600;
    border-radius: 10px;
    padding: 8px 20px;
    margin-top: 6px;
    transition: all 0.22s;
    letter-spacing: 0.03em;
    box-shadow: 0 2px 7px 0 rgba(255,225,93,0.07);
  }
  .btn-outline-light:hover {
    background: linear-gradient(90deg, #ffe066 60%, #e0be41 100%);
    color: #22262a;
    transform: translateY(-2px) scale(1.04);
    border-color: #ffe066;
    box-shadow: 0 6px 16px 0 rgba(255,225,93,0.14);
  }
  .pagination {
    margin-top: 28px;
    margin-bottom: 20px;
  }
  .pagination .page-link {
    color: #4fc3f7;
    background: #20252c;
    border: none;
    border-radius: 50%;
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    transition: background .2s, color .2s;
    margin: 0 3px;
  }
  .pagination .page-item.active .page-link, .pagination .page-link:hover {
    background: linear-gradient(90deg, #4fc3f7 70%, #ffe066 100%);
    color: #22262a;
    font-weight: 700;
    box-shadow: 0 2px 10px 0 rgba(79,195,247,0.12);
  }
  .pagination .page-item.disabled .page-link {
    background: #23282c;
    color: #747a85;
  }
  @media (max-width: 800px) {
    .product-title { font-size: 1.4rem; }
    .card-custom { padding: 15px 5vw;}
    .card-custom img { max-height: 135px; }
    .card-custom h5 { font-size: 1.18rem; }
    .card-custom .price { font-size: 1rem; }
  }
</style>

<div class="container mt-4">
  <h2 class="product-title text-center" data-aos="fade-down">Ipad</h2>
  <div class="row">
    {% for product in products %}
      <div class="col-md-4 col-sm-6 mb-4" data-aos="zoom-in-up" data-aos-delay="{{ forloop.counter0|add:'100' }}">
        <div class="card-custom h-100">
          <img src="{{ product.image.url }}" loading="lazy" class="img-fluid" alt="{{ product.name }}">
          <h5 data-aos="fade-up" data-aos-delay="150">{{ product.name }}</h5>
          {% with product.variants.first as variant %}
            {% if variant %}
              <p class="price" data-raw-price="{{ variant.price }}" data-aos="fade-up" data-aos-delay="200"></p>
            {% else %}
              <p class="text-muted fst-italic" data-aos="fade-up" data-aos-delay="200">Liên hệ để biết giá</p>
            {% endif %}
          {% endwith %}
          <a href="{% url 'product_detail' product.id %}" class="btn btn-outline-light" data-aos="fade-up" data-aos-delay="250">Xem chi tiết</a>
        </div>
      </div>
    {% empty %}
      <p class="text-center text-white" data-aos="fade-in">Không có sản phẩm iPhone nào.</p>
    {% endfor %}
  </div>

  {% if products.has_other_pages %}
    <nav aria-label="Page navigation" data-aos="fade-up" data-aos-delay="150">
      <ul class="pagination justify-content-center">
        {% if products.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ products.previous_page_number }}">&laquo;</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
        {% endif %}
        {% for num in products.paginator.page_range %}
          {% if products.number == num %}
            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
          {% elif num >= products.number|add:'-2' and num <= products.number|add:'2' %}
            <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
          {% endif %}
        {% endfor %}
        {% if products.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ products.next_page_number }}">&raquo;</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</div>

<!-- Format giá -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll('.price').forEach(function (el) {
      const raw = el.getAttribute('data-raw-price');
      if (raw) {
        const num = parseFloat(raw);
        if (!isNaN(num)) {
          el.textContent = num.toLocaleString('vi-VN') + '₫';
        }
      } 
    });
  });
</script>

<!-- AOS JS -->
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script>
  AOS.init({
    duration: 800,
    offset: 50,
    easing: 'ease-in-out',
    once: true
  });
</script>
{% endblock %}
