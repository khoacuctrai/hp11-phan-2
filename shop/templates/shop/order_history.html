{% extends 'shop/base.html' %}
{% block title %}L·ªãch s·ª≠ ƒë∆°n h√†ng{% endblock %}

{% block content %}
<style>
  :root{
    --bg:#191c1f; --card:#23272b; --card2:#20222a; --text:#e6eef7; --muted:#a7b3c6;
    --primary:#58b2ff; --primary-2:#2e6cb9; --accent:#44f47e; --warning:#ffde48; --danger:#ff5e7a;
    --border:rgba(255,255,255,.08); --shadow:0 10px 35px rgba(0,0,0,.25); --glass:rgba(255,255,255,.06);
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f5f7fb; --card:#ffffff; --card2:#fafbff; --text:#0c1b2a; --muted:#4a5568;
      --primary:#2e6cb9; --primary-2:#1f5aa0; --accent:#12b886; --warning:#b08900; --danger:#c92a2a;
      --border:rgba(0,0,0,.08); --shadow:0 10px 35px rgba(30,60,90,.12); --glass:rgba(0,0,0,.04);
    }
  }
  body { background: var(--bg); color: var(--text); }
  .oh-wrap{ max-width: 920px; margin: 38px auto 36px; padding: 0 14px; }
  .oh-title{ font-size: clamp(1.35rem, 2.4vw, 1.9rem); font-weight:800; letter-spacing:.2px;
             background: linear-gradient(92deg,var(--primary),#7dd3fc 48%,var(--accent));
             -webkit-background-clip: text; -webkit-text-fill-color: transparent; display:flex; gap:8px; }
  .order-card{ background: linear-gradient(110deg, var(--card) 78%, var(--card2) 100%);
               border:1px solid var(--border); border-radius:18px; box-shadow:var(--shadow);
               margin-bottom:16px; overflow:hidden; transform:translateY(8px); opacity:0;
               animation: slideUp .6s ease forwards; }
  @keyframes slideUp{ to { transform: translateY(0); opacity: 1; } }
  .order-head{ background: linear-gradient(90deg, var(--primary-2) 0, var(--primary) 100%); color:#fff;
               padding:14px 18px; display:flex; align-items:center; justify-content:space-between; }
  .order-id{ font-weight:700; display:flex; align-items:center; gap:8px; }
  .order-date{ opacity:.95; font-weight:600; }
  .order-body{ padding:16px 18px 6px 18px; }
  .info-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px 16px; }
  .info-grid p{ margin:0; } .info-grid strong{ color:#9bd5ff; font-weight:700; }
  .badge{ display:inline-flex; align-items:center; gap:6px; font-size:.86rem; padding:6px 10px;
          border-radius:999px; border:1px solid var(--border); background:var(--glass); }
  .badge-success{ color:#17c964; border-color:#17c96440; background:#17c96415; }
  .badge-danger{ color:var(--danger); border-color:#ff5e7a40; background:#ff5e7a15; }
  .coupon-pill{ display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:999px;
                background:linear-gradient(90deg,#0ea5e9 0,#22d3ee 100%); color:#072b3a; font-weight:800; margin:.3rem 0 .6rem; }
  .toggle{ display:flex; align-items:center; gap:10px; margin-top:10px; }
  .btn{ position:relative; overflow:hidden; border:1px solid var(--border); background:var(--glass); color:inherit;
        padding:9px 14px; border-radius:12px; font-weight:700; cursor:pointer; transition:.2s transform,.2s filter; }
  .btn:hover{ filter:brightness(1.06); transform:translateY(-1px); }
  .btn-primary{ background:linear-gradient(90deg,var(--primary) 0,#7dd3fc 100%); color:#08121f; border:none; }
  .products{ margin:10px 0 6px; padding:0; list-style:none; display:grid; gap:8px; }
  .products li{ display:flex; align-items:center; justify-content:space-between; border:1px dashed var(--border);
                background:var(--glass); border-radius:10px; padding:9px 12px; }
  .totals{ display:grid; gap:6px; margin-top:12px; justify-content:end; text-align:right; }
  .total-line{ display:flex; align-items:center; justify-content:flex-end; gap:10px; }
  .total-label{ color:var(--muted); font-weight:600; }
  .total-value{ font-weight:800; }
  .total-grand{ font-size:1.25rem; color:var(--warning);
                background:linear-gradient(90deg,#fcf7ce 20%,#ffe599 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
  .skeleton{ background:linear-gradient(100deg,var(--glass) 30%,rgba(255,255,255,.15) 45%,var(--glass) 60%) no-repeat;
             background-size:200% 100%; animation:shine 1.2s infinite; }
  @keyframes shine{ to{ background-position-x:-200%; } }
  .empty{ text-align:center; color:var(--muted); font-style:italic; padding:38px 12px; }
  @media (max-width:720px){ .info-grid{ grid-template-columns:1fr; } }
</style>

<div class="oh-wrap">
  <div class="oh-title">üßæ L·ªãch s·ª≠ ƒë∆°n h√†ng</div>

  {% if orders %}
    {% for order in orders %}
    <div class="order-card"
         data-order-id="{{ order.id }}"
         data-status="{% if order.is_paid %}paid{% else %}unpaid{% endif %}">
      <div class="order-head">
        <div class="order-id">
          <span>üõçÔ∏è</span> <span>ƒê∆°n h√†ng #{{ order.id }}</span>
        </div>
        <div style="display:flex; align-items:center; gap:10px;">
          <span class="badge {% if order.is_paid %}badge-success{% else %}badge-danger{% endif %}">
            {% if order.is_paid %}ƒê√É THANH TO√ÅN{% else %}CH∆ØA THANH TO√ÅN{% endif %}
          </span>
          <span class="order-date">{{ order.created_at|date:"d/m/Y H:i" }}</span>
        </div>
      </div>

      <div class="order-body">
        <div class="info-grid">
          <p><strong>üë§</strong> {{ order.full_name }}</p>
          <p><strong>üìß</strong> {{ order.email }}</p>
          <p><strong>üìû</strong> {{ order.phone }}</p>
          <p><strong>üìç</strong> {{ order.address }}</p>
        </div>

        {% if order.coupon %}
          <div class="coupon-pill">M√£: {{ order.coupon.code }} ‚Ä¢ ‚àí{{ order.discount_percent }}%</div>
        {% endif %}

        <div class="toggle">
          <button class="btn btn-ghost js-toggle" type="button" aria-expanded="false">Xem chi ti·∫øt</button>
          <div class="tools" style="display:flex; gap:8px;">
          
          </div>
        </div>

        <div class="details" style="display:none; margin-top:10px;">
          <h6 style="margin:8px 0 6px;">üõí S·∫£n ph·∫©m</h6>
          <ul class="products">
            {% for item in order.items.all %}
              <li>
                <span>{{ item.product.name }}</span>
                <span>√ó {{ item.quantity }}</span>
              </li>
            {% endfor %}
          </ul>

          <div class="totals">
            <div class="total-line">
              <span class="total-label">T·∫°m t√≠nh</span>
              <span class="total-value money">{{ order.subtotal_before_discount }}</span>
            </div>
            <div class="total-line">
              <span class="total-label">Gi·∫£m gi√°</span>
              <span class="total-value money">-{{ order.discount_amount }}</span>
            </div>
            <div class="total-line">
              <span class="total-label">Thanh to√°n</span>
              <span class="total-value money total-grand">{{ order.total_after_discount }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <div class="order-card skeleton" style="height:120px;"></div>
    <div class="order-card skeleton" style="height:120px;"></div>
    <div class="order-card skeleton" style="height:120px;"></div>
    <div class="empty">B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</div>
  {% endif %}
</div>

<script>
(function(){
  const fmt = n => Number(String(n).replace(/[^\d]/g,'')||0).toLocaleString('vi-VN')+'ƒë';
  document.querySelectorAll('.money').forEach(el => el.textContent = fmt(el.textContent));

  // Ripple
  document.addEventListener('click', e=>{
    const btn = e.target.closest('.btn'); if(!btn) return;
    const r = document.createElement('span'); r.className = 'ripple';
    const rect = btn.getBoundingClientRect();
    r.style.left = (e.clientX - rect.left) + 'px';
    r.style.top  = (e.clientY - rect.top)  + 'px';
    r.style.width = r.style.height = Math.max(rect.width, rect.height) + 'px';
    btn.appendChild(r); setTimeout(()=>r.remove(), 650);
  });

  // Toggle details
  document.querySelectorAll('.js-toggle').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const details = btn.closest('.order-body').querySelector('.details');
      const isOpen = details.style.display !== 'none';
      details.style.display = isOpen ? 'none' : 'block';
      btn.setAttribute('aria-expanded', String(!isOpen));
      btn.textContent = isOpen ? 'Xem chi ti·∫øt' : '·∫®n chi ti·∫øt';
    });
  });

  // Copy order id
  document.querySelectorAll('.js-copy').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const val = btn.dataset.copy;
      try { await navigator.clipboard.writeText(val); btn.textContent = '‚úÖ ƒê√£ copy';
            setTimeout(()=>btn.textContent='Copy m√£', 1200); }
      catch { alert('Kh√¥ng copy ƒë∆∞·ª£c, vui l√≤ng copy th·ªß c√¥ng.'); }
    });
  });
})();
</script>
{% endblock %}
