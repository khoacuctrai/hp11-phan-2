{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sản phẩm</title>

  <!-- Bootstrap & FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="{% static 'styles.css' %}">
  <style>
    body {
      background-color: #17191d;
      color: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
    }
    .navbar {
      background: rgba(30, 30, 30, 0.82);
      backdrop-filter: blur(12px);
      border-radius: 0 0 20px 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.34);
      transition: all 0.3s;
      font-size: 1.08rem;
    }
    .navbar-brand {
      font-size: 1.7rem;
      font-weight: 900;
      color: #ffe15d;
      letter-spacing: .06em;
      transition: 0.3s;
      text-shadow: 0 2px 10px #3c1a1278;
    }
    .navbar-brand:hover {
      color: #ffea81;
      transform: scale(1.05);
    }
    .nav-link {
      color: #f8f9fa;
      margin-right: 12px;
      font-weight: 500;
      letter-spacing: .01em;
      transition: 0.2s;
      border-radius: 7px;
      padding: 8px 15px !important;
    }
    .nav-link.active, .nav-link:focus, .nav-link:hover {
      color: #ffe15d;
      background: rgba(255,225,93,0.07);
      text-shadow: 0 0 7px #ffe15d5e;
      font-weight: 700;
    }
    .dropdown-menu {
      border-radius: 10px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.36);
      background: #22232d;
    }
    .dropdown-menu a {
      color: #f5d00a;
      font-weight: 600;
      transition: 0.3s;
    }
    .dropdown-menu a:hover {
      background: #ffe15d1a;
      color: #22262a;
    }
    .btn-outline-light.btn-sm:hover,
    .btn-outline-light.btn-sm:focus {
      background: #ffe15d;
      color: #22262a;
      border-color: #ffe15d;
      font-weight: 700;
      box-shadow: 0 0 0 0.14rem #ffe15d5a;
    }
    .btn-cart {
      transition: transform 0.3s, background-color 0.3s;
      border-radius: 8px;
      margin-left: 10px;
      font-weight: 700;
    }
    .btn-cart:hover {
      transform: scale(1.06);
      background-color: #ffe15d;
      color: #22262a;
      border-color: #ffe15d;
    }
    /* Search dropdown */
    #searchForm {
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transition: all 0.36s cubic-bezier(.43,.19,.61,1.21);
      pointer-events: none;
    }
    #searchForm.show {
      max-height: 120px;
      opacity: 1;
      pointer-events: auto;
    }
    .search-wrapper .form-control {
      background: #20252c;
      color: #fff;
      border-radius: 9px;
      border: 1.2px solid #3a414b;
      font-size: 1.05rem;
    }
    .search-wrapper .form-control:focus {
      border-color: #ffe15d;
      background: #25272e;
      color: #fff;
      box-shadow: 0 0 0 0.18rem #ffe15d42;
    }
    /* Category Bar */
    .category-bar {
      background: rgba(30, 30, 30, 0.72);
      border-radius: 18px;
      margin: 20px 0 28px 0;
      padding: 20px 10px 15px 10px;
      box-shadow: 0 4px 22px 0 rgba(255,225,93,0.08);
    }
    .category-item {
      min-width: 110px;
      max-width: 120px;
      background: #23232c;
      border-radius: 12px;
      box-shadow: 0 2px 9px #fff3;
      padding: 12px 8px 8px 8px;
      transition: transform 0.21s, box-shadow 0.18s, background 0.21s;
    }
    .category-item:hover {
      background: #ffe15d33;
      color: #22262a !important;
      transform: scale(1.04) translateY(-3px);
      box-shadow: 0 7px 26px 0 #ffe15d3a;
      text-decoration: none;
    }
    .category-item img {
      max-height: 80px;
      transition: filter 0.18s;
      filter: drop-shadow(0 1px 8px #ffe15d22);
    }
    .category-item p {
      margin-bottom: 0;
      font-weight: 700;
      font-size: 1.09rem;
      letter-spacing: .01em;
      color: #ffe15d;
      text-shadow: 0 1px 5px #ffe15d18;
    }
    @media (max-width: 700px) {
      .navbar, .category-bar { border-radius: 0; }
      .category-item { min-width: 80px; max-width: 100px; padding: 10px 4px 6px 4px;}
      .category-item img { max-height: 50px; }
      .category-item p { font-size: 0.92rem;}
    }

    :root{
    --bg:#191c1f; --card:#23272b; --card2:#20222a; --text:#e6eef7; --muted:#a7b3c6;
    --primary:#58b2ff; --primary-2:#2e6cb9; --accent:#44f47e; --warning:#ffde48; --danger:#ff5e7a;
    --border:rgba(255,255,255,.08); --shadow:0 10px 35px rgba(0,0,0,.25); --glass:rgba(255,255,255,.06);
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f5f7fb; --card:#ffffff; --card2:#fafbff; --text:#0c1b2a; --muted:#4a5568;
      --primary:#2e6cb9; --primary-2:#1f5aa0; --accent:#12b886; --warning:#b08900; --danger:#c92a2a;
      --border:rgba(0,0,0,.08); --shadow:0 10px 35px rgba(30,60,90,.12); --glass:rgba(0,0,0,.04);
    }
  }
  body { background: var(--bg); color: var(--text); }
  .oh-wrap{ max-width: 920px; margin: 38px auto 36px; padding: 0 14px; }
  .oh-title{ font-size: clamp(1.35rem, 2.4vw, 1.9rem); font-weight:800; letter-spacing:.2px;
             background: linear-gradient(92deg,var(--primary),#7dd3fc 48%,var(--accent));
             -webkit-background-clip: text; -webkit-text-fill-color: transparent; display:flex; gap:8px; }
  .order-card{ background: linear-gradient(110deg, var(--card) 78%, var(--card2) 100%);
               border:1px solid var(--border); border-radius:18px; box-shadow:var(--shadow);
               margin-bottom:16px; overflow:hidden; transform:translateY(8px); opacity:0;
               animation: slideUp .6s ease forwards; }
  @keyframes slideUp{ to { transform: translateY(0); opacity: 1; } }
  .order-head{ background: linear-gradient(90deg, var(--primary-2) 0, var(--primary) 100%); color:#fff;
               padding:14px 18px; display:flex; align-items:center; justify-content:space-between; }
  .order-id{ font-weight:700; display:flex; align-items:center; gap:8px; }
  .order-date{ opacity:.95; font-weight:600; }
  .order-body{ padding:16px 18px 6px 18px; }
  .info-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px 16px; }
  .info-grid p{ margin:0; } .info-grid strong{ color:#9bd5ff; font-weight:700; }
  .badge{ display:inline-flex; align-items:center; gap:6px; font-size:.86rem; padding:6px 10px;
          border-radius:999px; border:1px solid var(--border); background:var(--glass); }
  .badge-success{ color:#17c964; border-color:#17c96440; background:#17c96415; }
  .badge-danger{ color:var(--danger); border-color:#ff5e7a40; background:#ff5e7a15; }
  .coupon-pill{ display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:999px;
                background:linear-gradient(90deg,#0ea5e9 0,#22d3ee 100%); color:#072b3a; font-weight:800; margin:.3rem 0 .6rem; }
  .toggle{ display:flex; align-items:center; gap:10px; margin-top:10px; }
  .btn{ position:relative; overflow:hidden; border:1px solid var(--border); background:var(--glass); color:inherit;
        padding:9px 14px; border-radius:12px; font-weight:700; cursor:pointer; transition:.2s transform,.2s filter; }
  .btn:hover{ filter:brightness(1.06); transform:translateY(-1px); }
  .btn-primary{ background:linear-gradient(90deg,var(--primary) 0,#7dd3fc 100%); color:#08121f; border:none; }
  .products{ margin:10px 0 6px; padding:0; list-style:none; display:grid; gap:8px; }
  .products li{ display:flex; align-items:center; justify-content:space-between; border:1px dashed var(--border);
                background:var(--glass); border-radius:10px; padding:9px 12px; }
  .totals{ display:grid; gap:6px; margin-top:12px; justify-content:end; text-align:right; }
  .total-line{ display:flex; align-items:center; justify-content:flex-end; gap:10px; }
  .total-label{ color:var(--muted); font-weight:600; }
  .total-value{ font-weight:800; }
  .total-grand{ font-size:1.25rem; color:var(--warning);
                background:linear-gradient(90deg,#fcf7ce 20%,#ffe599 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
  .skeleton{ background:linear-gradient(100deg,var(--glass) 30%,rgba(255,255,255,.15) 45%,var(--glass) 60%) no-repeat;
             background-size:200% 100%; animation:shine 1.2s infinite; }
  @keyframes shine{ to{ background-position-x:-200%; } }
  .empty{ text-align:center; color:var(--muted); font-style:italic; padding:38px 12px; }
  @media (max-width:720px){ .info-grid{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark sticky-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="{% url 'home' %}">Khoazone</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNavbar">
      <!-- Nav Links -->
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link{% if request.resolver_match.url_name == 'iphone_products' %} active{% endif %}" href="{% url 'iphone_products' %}">iPhone</a></li>
        <li class="nav-item"><a class="nav-link{% if request.resolver_match.url_name == 'macbook_products' %} active{% endif %}" href="{% url 'macbook_products' %}">MacBook</a></li>
        <li class="nav-item"><a class="nav-link{% if request.resolver_match.url_name == 'ipad_products' %} active{% endif %}" href="{% url 'ipad_products' %}">iPad</a></li>
        <li class="nav-item"><a class="nav-link{% if request.resolver_match.url_name == 'watch_products' %} active{% endif %}" href="{% url 'watch_products' %}">Watch</a></li>
        <li class="nav-item"><a class="nav-link{% if request.resolver_match.url_name == 'audio_products' %} active{% endif %}" href="{% url 'audio_products' %}">Tai nghe</a></li>
        <li class="nav-item"><a class="nav-link{% if request.resolver_match.url_name == 'accessory_products' %} active{% endif %}" href="{% url 'accessory_products' %}">Phụ kiện</a></li>
        <li class="nav-item"><a class="nav-link{% if request.resolver_match.url_name == 'feedback' %} active{% endif %}" href="{% url 'feedback' %}">Góp ý / Khiếu nại</a></li>
      </ul>
      <!-- Search -->
      <div class="search-wrapper position-relative me-3">
        <button class="btn btn-outline-light btn-sm" id="toggleSearch" type="button">
          <i class="fas fa-search"></i>
        </button>
        <form id="searchForm" class="position-absolute top-100 start-0 mt-2 bg-dark p-2 rounded shadow"
              style="z-index: 1000; width: 250px;" action="{% url 'search_products' %}" method="get">
          <div class="input-group">
            <input class="form-control form-control-sm" name="q" type="search" placeholder="Tìm sản phẩm...">
            <button class="btn btn-outline-light btn-sm" type="submit">Tìm</button>
          </div>
        </form>
      </div>
      <!-- Tài khoản -->
      <div class="dropdown me-3">
        <button class="btn btn-light dropdown-toggle btn-sm" type="button" id="authDropdown"
                data-bs-toggle="dropdown" aria-expanded="false">
          {% if request.user.is_authenticated %}
            👤 {{ request.user.username }}
          {% else %}
            Tài khoản
          {% endif %}
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="authDropdown">
          {% if request.user.is_authenticated %}
            <li><a class="dropdown-item" href="{% url 'order_history' %}">Lịch sử đơn hàng</a></li>
            <form method="POST" action="{% url 'logout' %}" class="px-3 py-1">
              {% csrf_token %}
              <button type="submit" class="btn btn-outline-dark btn-sm w-100">Đăng xuất</button>
            </form>
          {% else %}
            <li><a class="dropdown-item" href="{% url 'login' %}">Đăng nhập</a></li>
            <li><a class="dropdown-item" href="{% url 'signup' %}">Đăng ký</a></li>
          {% endif %}
        </ul>
      </div>
      <!-- Giỏ hàng -->
      <a href="{% url 'cart' %}" class="btn btn-outline-light btn-sm btn-cart">🛒 Giỏ hàng</a>
    </div>
  </div>
</nav>

<!-- Carousel (nếu cần) -->
{% include 'shop/carousel.html' %}

<!-- Category Bar đồng bộ -->
<div class="category-bar d-flex justify-content-center flex-wrap gap-3 py-4">
  <a href="{% url 'iphone_products' %}" class="category-item text-center text-decoration-none text-white">
    <img src="https://product.hstatic.net/200000348419/product/16_hero_8989f185e9cf4a9d8165236eeaa97c74_master.png" alt="iPhone">
    <p class="mt-2">iPhone</p>
  </a>
  <a href="{% url 'macbook_products' %}" class="category-item text-center text-decoration-none text-white">
    <img src="https://product.hstatic.net/200000348419/product/macbook_air_13_inch_m1_2020_silver_0_61ab8f169379480c894e67ecd821d448_large.png" alt="Mac">
    <p class="mt-2">Mac</p>
  </a>
  <a href="{% url 'ipad_products' %}" class="category-item text-center text-decoration-none text-white">
    <img src="https://bizweb.dktcdn.net/thumb/large/100/444/581/products/1-d7546ef2-3d2c-4c82-ab9d-21eb44127acf.png?v=1720253464613" alt="iPad">
    <p class="mt-2">iPad</p>
  </a>
  <a href="{% url 'watch_products' %}" class="category-item text-center text-decoration-none text-white">
    <img src="https://cdn.tgdd.vn/Products/Images/7077/316008/s16/t%C3%A1ch%20n%E1%BB%81n%20site%2016%20(2)-650x650.png" alt="Watch">
    <p class="mt-2">Watch</p>
  </a>
  <a href="{% url 'audio_products' %}" class="category-item text-center text-decoration-none text-white">
    <img src="https://product.hstatic.net/200000348419/product/airpods-max-2024-0_8858229875d4450d8ddd918247a71f54.png" alt="Tai nghe, loa">
    <p class="mt-2">Tai nghe, loa</p>
  </a>
  <a href="{% url 'accessory_products' %}" class="category-item text-center text-decoration-none text-white">
    <img src="https://cdn.tgdd.vn/Products/Images/9499/230315/s16/adapter-sac-type-c-20w-cho-iphone-ipad-apple-mhje3-101021-023343-650x650.png" alt="Phụ kiện">
    <p class="mt-2">Phụ kiện</p>
  </a>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggleBtn = document.getElementById("toggleSearch");
    const searchForm = document.getElementById("searchForm");

    toggleBtn.addEventListener("click", function (e) {
      e.stopPropagation();
      searchForm.classList.toggle("show");
      const input = searchForm.querySelector("input");
      if (searchForm.classList.contains("show")) {
        setTimeout(() => input.focus(), 300);
      }
    });

    document.addEventListener("click", function (e) {
      if (!searchForm.contains(e.target) && !toggleBtn.contains(e.target)) {
        searchForm.classList.remove("show");
      }
    });
  });
</script>
</body>
</html>
